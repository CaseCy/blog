<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://casecy.github.io/blog').hostname,
    root: '/blog/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":"flat"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="A Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Me">
<meta property="og:url" content="https://casecy.github.io/blog/index.html">
<meta property="og:site_name" content="Me">
<meta property="og:description" content="A Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="C.c">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://casecy.github.io/blog/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Me</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Me</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/12/04/nacos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/12/04/nacos/" class="post-title-link" itemprop="url">Nacos探索和实践</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-04 09:05:38" itemprop="dateCreated datePublished" datetime="2020-12-04T09:05:38+08:00">2020-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/nacos/" itemprop="url" rel="index">
                    <span itemprop="name">nacos</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>默认以spring cloud项目来描述使用方式</p>
<p>使用的版本</p>
<ul>
<li>spring-boot:2.1.x</li>
<li>spring-cloud:Greenwich.RELEASE</li>
<li>spring-cloud-alibaba:2.1.x</li>
<li>java:1.8+</li>
</ul>
<h2 id="Nacos服务端"><a href="#Nacos服务端" class="headerlink" title="Nacos服务端"></a>Nacos服务端</h2><p>服务端相当于euraka和spring-cloud-config的集合，Nacos的web页面，服务注册，和配置全部在服务端上</p>
<h2 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h2><p>注册中心和eureka差不多，只是Nacos提供了不同的页面，不过可以在服务详情里通过页面控制服务的上下线，这点还是比较方便，和配置中心一样，也可以通过Group+Namespace来管理服务，Nacos的服务的调用支持Feign和Dubbo</p>
<p><img src="/static/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.png" alt=""></p>
<h2 id="配置中心"><a href="#配置中心" class="headerlink" title="配置中心"></a>配置中心</h2><p>Nacos支持spring、spring-boot、spring-cloud的配置管理。</p>
<p>Nacos的服务配置内容必须写在bootstrap.properties/yml中，Nacos默认会去读取以服务名称开头的配置，这里的配置的唯一id就是dataId，其组成如下：</p>
<blockquote>
<p>在 Nacos Spring Cloud 中，<code>dataId</code> 的完整格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li>
<li><code>spring.profiles.active</code> 即为当前环境对应的 profile，详情可以参考 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles">Spring Boot文档</a>。 <strong>注意：当 <code>spring.profiles.active</code> 为空时，对应的连接符 <code>-</code> 也将不存在，dataId 的拼接格式变成 <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code></strong></li>
<li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li>
</ul>
</blockquote>
<p>除了服务名称开头的配置文件，Nacos还支持通过<code>spring.cloud.nacos.config.shared-configs[n].data-id</code>和<code>spring.cloud.nacos.config.extension-configs[n].data-id</code>的方式添加额外的配置，其加载的顺序如下</p>
<h3 id="配置读取的顺序"><a href="#配置读取的顺序" class="headerlink" title="配置读取的顺序"></a>配置读取的顺序</h3><blockquote>
<p>Spring Cloud Alibaba Nacos Config 目前提供了三种配置能力从 Nacos 拉取相关的配置。</p>
<ul>
<li>A: 通过 <code>spring.cloud.nacos.config.shared-configs[n].data-id</code> 支持多个共享 Data Id 的配置</li>
<li>B: 通过 <code>spring.cloud.nacos.config.extension-configs[n].data-id</code> 的方式支持多个扩展 Data Id 的配置</li>
<li>C: 通过内部相关规则(应用名、应用名+ Profile )自动生成相关的 Data Id 配置</li>
</ul>
<p>当三种方式共同使用时，他们的一个优先级关系是:A &lt; B &lt; C</p>
</blockquote>
<p>可以参看：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config">https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config</a></p>
<p>关于spring-boot的配置加载顺序可以参照<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.18.RELEASE/reference/html/boot-features-external-config.html">Externalized Configuration</a>，关于为什么写在bootstrap.properties/yml中可以参照<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR1/single/spring-cloud.html#_the_bootstrap_application_context">application-context</a></p>
<h3 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h3><p>Nacos使用Group和Namespace来管理配置文件，每个配置文件都有一个Group和一个Namespace属性，包含关系是Group在Namespace下，而配置文件在Group下，可以使用这两个属性来区分不同的环境和场景</p>
<p><img src="/static/%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt=""></p>
<h2 id="搭建Nacos项目"><a href="#搭建Nacos项目" class="headerlink" title="搭建Nacos项目"></a>搭建Nacos项目</h2><p>引入spring-cloud-alibaba版本依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>版本依据spring-boot的版本而定，依赖版本可以查看<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/releases">发布版本</a>，如下图</p>
<p><img src="/static/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86.png" alt="版本管理.png"></p>
<p>也可以参看这个<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E">https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E</a></p>
<h3 id="服务端使用"><a href="#服务端使用" class="headerlink" title="服务端使用"></a>服务端使用</h3><p>参看Nacos<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/quick-start.html">官方</a></p>
<p>目前项目是直接下载的Nacos<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases">稳定版本</a>的压缩包</p>
<p>并使用(Linux)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/startup.sh -m standalone</span><br></pre></td></tr></table></figure>

<p>单机启动，如果不加<code>-m standalone</code>的话默认是集群模式</p>
<p>启动配置文件<code>conf/application.properties</code>,可以在里面制定数据库，将配置文件存放到数据库中，使用数据库需要先初始化数据库，数据库脚本<code>conf/nacos-mysql.sql</code></p>
<p>启动后访问<a target="_blank" rel="noopener" href="http://ip:8848/nacos">http://ip:8848/nacos</a>可以看到Nacos登录页面，默认登录账户名密码 nacos nacos</p>
<p><img src="/static/%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2.png" alt=""></p>
<h3 id="注册中心使用"><a href="#注册中心使用" class="headerlink" title="注册中心使用"></a>注册中心使用</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在bootstrap.yml或者bootstrap.properties中加入注册中心设置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nacos的地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">Nacos-server地址</span></span><br><span class="line"><span class="comment"># 命名空间，可不填，默认public</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.namespace</span>=<span class="string">NACOS命名空间</span></span><br></pre></td></tr></table></figure>

<p>如果要使用Feign，和以前euraka的使用方法一致，Dubbo可以参看<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html">https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html</a></p>
<h3 id="配置中心使用"><a href="#配置中心使用" class="headerlink" title="配置中心使用"></a>配置中心使用</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在bootstrap.yml或者bootstrap.properties中加入配置中心设置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">Nacos-server地址</span></span><br><span class="line"><span class="comment"># 这个是必须要的</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">example</span></span><br></pre></td></tr></table></figure>

<p>如果不需要额外配置的话就使用这个就可以了</p>
<p>如果需要添加额外的配置，这里只列举一些项目中用的比较多的配置</p>
<p>读取配置的顺序可以参考<a href="#配置中心"></a></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件后缀，这个配置只影响默认的配置（即服务名称+环境+文件后缀的形式）</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.file-extension</span>=<span class="string">properties</span></span><br><span class="line"><span class="comment"># 文件分组，这个配置只影响默认的配置（即服务名称+环境+文件后缀的形式）</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.group</span>=<span class="string">APPLICATION_GROUP</span></span><br><span class="line"><span class="comment"># 共享的配置（DEFAULT_GROUP）</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.shared-configs</span>=<span class="string">application.properties</span></span><br><span class="line"><span class="comment"># NACOS的命名空间</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">NACOS的命名空间</span></span><br><span class="line"><span class="comment"># 额外配置</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.extension-configs[0].data-id</span>=<span class="string">xxxxx.properties</span></span><br><span class="line"><span class="comment"># 是否自动更新，默认是false，可以不写</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.extension-configs[0].refresh</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 分组（默认是DEFAULT_GROUP，可以不写</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.extension-configs[0].group</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.extension-configs[1].data-id</span>=<span class="string">xxx.properties</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.extension-configs[1].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h4 id="动态刷新"><a href="#动态刷新" class="headerlink" title="动态刷新"></a>动态刷新</h4><p>在项目（Spring cloud项目）中使用<code>@RefeshScope</code>注解就可以实现动态刷新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/config&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;useLocalCache:false&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> useLocalCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> useLocalCache;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里在nacos上修改了useLocalCache为true之后，然后调用接口，可以看到接口返回的值为true</p>
<p>使用该注解可以引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="批量导入配置"><a href="#批量导入配置" class="headerlink" title="批量导入配置"></a>批量导入配置</h4><p>Nacos支持批量导入配置，目前我所知有两种方式</p>
<ul>
<li>直接将Nacos的数据库导出sql，然后再导入另外的数据库</li>
<li>在页面上使用导入配置功能</li>
</ul>
<p>这里只介绍第二种方式，选择配置管理-&gt;配置列表，要导入的命名空间</p>
<p><img src="/static/%E5%AF%BC%E5%85%A5%E9%85%8D%E7%BD%AE.png" alt=""></p>
<p><img src="/static/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6.png" alt=""></p>
<p>选择上传文件，Nacos目前好像只支持zip压缩包</p>
<p>配置要放在一个文件夹中，文件夹的名称为导入后的Group名称，所以导入的结构</p>
<p>└─Group名称<br>    └─xxx.properties<br>    └─xxx.yml</p>
<p>弄好之后压缩为zip文件，然后导入即可</p>
<h2 id="项目应用说明"><a href="#项目应用说明" class="headerlink" title="项目应用说明"></a>项目应用说明</h2><p>目前在项目中使用Nacos作为配置中心和注册中心，本地只留了一个bootstrap.properties文件，其他配置全部使用nacos管理，使用Nacos的命令空间来管理不同环境的配置，如果目前项目使用check和pro来表示命名空间，使用group来区分公共文件和服务配置文件，如APPLICATION_GROUP和DEFAULT_GROUP，注册中心目前就是简单的注册功能，Nacos目前使用的是单机+mysql</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos">Nacos GitHub</a></p>
<p><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/what-is-nacos.html">Nacos文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba">Spring Cloud Alibaba GitHub</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/02/21/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/02/21/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">数据库如何存储时间</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-21 19:04:52" itemprop="dateCreated datePublished" datetime="2020-02-21T19:04:52+08:00">2020-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：</p>
<p> <a target="_blank" rel="noopener" href="https://juejin.im/post/5e1d494a5188254c45778a14">https://juejin.im/post/5e1d494a5188254c45778a14</a> </p>
<hr>
<h3 id="不要使用字符串存储时间"><a href="#不要使用字符串存储时间" class="headerlink" title="不要使用字符串存储时间"></a>不要使用字符串存储时间</h3><p>问题：</p>
<ul>
<li><p>字符串占用的空间更大</p>
</li>
<li><p>比较效率低（逐个字符比较），无法用日期相关的API进行计算</p>
</li>
</ul>
<h3 id="Datetime和Timestamp"><a href="#Datetime和Timestamp" class="headerlink" title="Datetime和Timestamp"></a>Datetime和Timestamp</h3><p>一般来讲选择Timestamp，why？</p>
<ul>
<li><p>从时区上：</p>
<p>Datetime类型保存的时间都是当前会话所设置的时区对应的时间，如果时区更换后，就会导致从数据库读取的时间有问题，而<strong>Timestamp是和时区有关的</strong>，他的值会随着时区的变化而变化（自动换算）</p>
</li>
<li><p>从耗费的空间上：</p>
<p><strong>DateTime类型耗费的空间更大</strong>，DateTime使用8个字节的存储空间，而Timestamp使用4个字节，也同样导致一个问题，Timestamp能表示的最大时间比DateTime小</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">DateTime</span> ：<span class="number">1000</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> ~ <span class="number">9999</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span></span><br><span class="line"><span class="attribute">Timestamp</span>： <span class="number">1970</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> ~ <span class="number">2037</span>-<span class="number">12</span>-<span class="number">31</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Timestamp 在不同版本的 MySQL 中有细微差别。 </p>
</blockquote>
<p>官方参考：</p>
<pre><code>https://dev.mysql.com/doc/refman/8.0/en/storage-requirements.html 

https://dev.mysql.com/doc/refman/8.0/en/datetime.html </code></pre></li>
</ul>
<p>除此之外还可以使用<code>int</code>和<code>bigint</code>存储时间戳，对比和进行日期排序和对比等操作效率会更高，但是缺点也很明显，就是不能够直观的显示具体的时间，可读性差</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="一些关于Mysql时区设置的常用命令"><a href="#一些关于Mysql时区设置的常用命令" class="headerlink" title="一些关于Mysql时区设置的常用命令"></a>一些关于Mysql时区设置的常用命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前会话时区</span><br><span class="line">SELECT @@session.time_zone;</span><br><span class="line"># 设置当前会话时区</span><br><span class="line">SET time_zone = &#x27;Europe/Helsinki&#x27;;</span><br><span class="line">SET time_zone = &quot;+00:00&quot;;</span><br><span class="line"># 数据库全局时区设置</span><br><span class="line">SELECT @@global.time_zone;</span><br><span class="line"># 设置全局时区</span><br><span class="line">SET GLOBAL time_zone = &#x27;+8:00&#x27;;</span><br><span class="line">SET GLOBAL time_zone = &#x27;Europe/Helsinki&#x27;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/02/21/mysql%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/02/21/mysql%E9%94%81/" class="post-title-link" itemprop="url">mysql锁</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-21 19:02:57" itemprop="dateCreated datePublished" datetime="2020-02-21T19:02:57+08:00">2020-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>按照使用方式，锁分为：</p>
<ul>
<li>悲观锁</li>
<li>乐观锁</li>
</ul>
<h2 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h2><p>概念就不细讲了，乐观锁和悲观锁的区别是乐观锁是假设在修改数据之前，所有的数据都不会有改变，只会在修改数据的时候才会去验证数据。乐观锁的实现mysql没有默认方法。可以自己手动实现，如增加一个字段version，每次去查询数据的时候把这个字段查出来，修改的时候检查这个字段是否和查出来的一致，如果一致，就修改，否则就抛出异常或者回滚。</p>
<p>引用参数考中的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>step1: 查询出商品信息</span><br><span class="line"><span class="keyword">select</span> (quantity,version) <span class="keyword">from</span> items <span class="keyword">where</span> id<span class="operator">=</span><span class="number">100</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>step2: 根据商品信息生成订单</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> orders(id,item_id) <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="number">100</span>);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>step3: 修改商品的库存</span><br><span class="line">update items <span class="keyword">set</span> quantity<span class="operator">=</span>quantity<span class="number">-1</span>,version<span class="operator">=</span>version<span class="operator">+</span><span class="number">1</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">100</span> <span class="keyword">and</span> version<span class="operator">=</span>#&#123;version&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>选择好作为乐观锁的字段，控制好乐观锁的粒度，能大大的提到系统的并发量</strong></p>
<h2 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h2><p>悲观锁会假设所有操作都是有风险的，从开始到结束，不管是select语句还是修改，删除语句全部在锁里面</p>
<p>优点是完美保证了事务的ACID特性，缺点是锁的粒度过大，导致并发性能下降</p>
<p>mysql的实现方式（互斥锁）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> update</span><br></pre></td></tr></table></figure>

<p>使用悲观锁需要将事务自动提交关闭。</p>
<p>即</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<p>这个操作会在执行select操作时就会对数据库进行加锁，直到该次事务提交，其他的事务才能够执行。</p>
<hr>
<p>按照锁的级别，分为：</p>
<ul>
<li><p>共享锁</p>
</li>
<li><p>排他锁（互斥锁）</p>
</li>
<li><p>意向锁</p>
</li>
<li><p>间隙锁</p>
</li>
</ul>
<h2 id="共享锁（share-lock，S锁）"><a href="#共享锁（share-lock，S锁）" class="headerlink" title="共享锁（share lock，S锁）"></a>共享锁（share lock，S锁）</h2><p>共享锁也被称为读锁</p>
<ul>
<li><p>其他事务只能对已经加共享锁的资源再加共享锁，不能再加其他的锁。</p>
</li>
<li><p>获得了共享锁的事务只能够读数据，不能够写数据。</p>
</li>
<li><p>对加了共享锁的资源进行的修改删除操作会被阻塞，直到事务提交（锁释放）。</p>
</li>
</ul>
<p>共享锁可以在多个事务中并发读取</p>
<p>mysql中的实现方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys_user lock <span class="keyword">in</span> share mode;</span><br></pre></td></tr></table></figure>

<p>加上之后<code>lock in share mode</code>后会对查询结果中的每行都加上共享锁</p>
<h2 id="排他锁（exclusive-lock，X锁）"><a href="#排他锁（exclusive-lock，X锁）" class="headerlink" title="排他锁（exclusive lock，X锁）"></a>排他锁（exclusive lock，X锁）</h2><p>排他锁也被称为写锁，顾名思义，资源被一个事务加锁后，不能被其他事务访问，修改，直到再次这个事务提交（锁释放）</p>
<ul>
<li><p>其他事务不能对已经加排他锁的资源再加锁，要获取锁只能等到事务提交（锁释放）</p>
</li>
<li><p>获取排他锁的事务可以对资源进行读写数据</p>
</li>
</ul>
<p>mysql中的实现方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> update</span><br></pre></td></tr></table></figure>

<h2 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h2><p>意向锁是InnoDB自动加的，不需要用户干预 ，意向锁也是一种表锁。</p>
<p>意向锁又分为意向共享锁（IS），意向排他锁（IX）</p>
<blockquote>
<p>意向锁的作用：<br>意向锁是在添加行锁之前添加。当再向一个表添加表级X锁的时候：<br>如果没有意向锁的话，则需要遍历所有整个表判断是否有行锁的存在，以免发生冲突。<br>如果有了意向锁，只需要判断该意向锁与即将添加的表级锁是否兼容即可。因为意向锁的存在代表了，有行级锁的存在或者即将有行级锁的存在。因而无需遍历整个表，即可获取结果。</p>
<p>引用官方的话来说就是：意向锁只会阻塞全表锁，不会阻塞没有交集的行锁。目的是为了提高读写性能。 </p>
</blockquote>
<h2 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h2><h2 id="表锁和行锁"><a href="#表锁和行锁" class="headerlink" title="表锁和行锁"></a>表锁和行锁</h2><p>在mysql 的 InnoDB引擎支持行锁，与Oracle不同，mysql的行锁是通过索引加载的，即是行锁是加在索引响应的行上的，要是对应的SQL语句没有走索引，则会全表扫描，行锁则无法实现，取而代之的是表锁。</p>
<hr>
<p>参考：</p>
<p> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ed896335b3b4">https://www.jianshu.com/p/ed896335b3b4</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/904f52bde904">https://www.jianshu.com/p/904f52bde904</a> </p>
<p>行锁和表锁：</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/u014453898/article/details/56068841">https://blog.csdn.net/u014453898/article/details/56068841</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fb06e23e3332">https://www.jianshu.com/p/fb06e23e3332</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/02/21/mysql%E7%9A%84join%E8%AF%AD%E5%8F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/02/21/mysql%E7%9A%84join%E8%AF%AD%E5%8F%A5/" class="post-title-link" itemprop="url">mysql的join语句</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-21 18:58:12" itemprop="dateCreated datePublished" datetime="2020-02-21T18:58:12+08:00">2020-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：</p>
<p> <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000015572505">https://segmentfault.com/a/1190000015572505</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/beginman/p/3754322.html">https://www.cnblogs.com/beginman/p/3754322.html</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins</a></p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/beginman/p/3754322.html">https://www.cnblogs.com/beginman/p/3754322.html</a> </p>
<hr>
<h3 id="Inner-Join"><a href="#Inner-Join" class="headerlink" title="Inner Join"></a>Inner Join</h3><p><img src="/static/InnerJoin.png" alt=""></p>
<p>数据包含关系如上图，这种Join<strong>会返回左边表和右边表满足匹配条件的所有的数据</strong>，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span> </span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br></pre></td></tr></table></figure>

<h3 id="Left-Join"><a href="#Left-Join" class="headerlink" title="Left Join"></a>Left Join</h3><p><img src="/static/LeftJoin.png" alt=""></p>
<p>Left Join会返回左边表的所有数据和右边表中和左边表中匹配的数据，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br></pre></td></tr></table></figure>

<h3 id="Right-Join"><a href="#Right-Join" class="headerlink" title="Right Join"></a>Right Join</h3><p><img src="/static/RightJoin.png" alt=""></p>
<p>Right Join是Left Join的对立面，Right Join会返回右边表的所有数据和左边表中和右边表中匹配的数据，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br></pre></td></tr></table></figure>

<h3 id="Outer-Join"><a href="#Outer-Join" class="headerlink" title="Outer Join"></a>Outer Join</h3><p><img src="/static/OutterJoin.png" alt=""></p>
<p>也可以称为<code>FULL OUTER JOIN</code>或者<code>FULL JOIN</code>，这种方式会返回两张表中的所有数据，将两张表中匹配的数据连接起来，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br></pre></td></tr></table></figure>

<h3 id="Left-Excluding-Join"><a href="#Left-Excluding-Join" class="headerlink" title="Left Excluding Join"></a>Left Excluding Join</h3><p><img src="/static/LeftExcludingJoin.png" alt=""></p>
<p>这种方式会返回左边表中和右边表中不匹配的所有数据，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span> </span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br><span class="line"><span class="keyword">WHERE</span> B.Key <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="Right-Excluding-Join"><a href="#Right-Excluding-Join" class="headerlink" title="Right Excluding Join"></a>Right Excluding Join</h3><p><img src="/static/RightExcludingJoin.png" alt=""></p>
<p>这种方式会返回右边表中和左边表中不匹配的所有数据，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br><span class="line"><span class="keyword">WHERE</span> A.Key <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="Outer-Excluding-JOIN"><a href="#Outer-Excluding-JOIN" class="headerlink" title="Outer Excluding JOIN"></a>Outer Excluding JOIN</h3><p><img src="/static/OuterExcludingJoin.png" alt=""></p>
<p>这种方式会返回左右两张表中都不匹配的数据，写法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>select_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.Key <span class="operator">=</span> B.Key</span><br><span class="line"><span class="keyword">WHERE</span> A.Key <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> B.Key <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p>例子参考： <a target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins</a> </p>
<h3 id="Cross-Join"><a href="#Cross-Join" class="headerlink" title="Cross Join"></a>Cross Join</h3><p>得到的是两个表的乘积，即笛卡尔积</p>
<p> <strong>在 MySQL 中（仅限于 MySQL） CROSS JOIN 与 INNER JOIN 的表现是一样的</strong> 在不指定 ON 条件得到的结果都是笛卡尔积，反之取得两个表完全匹配的结果。 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/02/21/Mybatis%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/02/21/Mybatis%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Mybatis缓存机制</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-21 18:54:25" itemprop="dateCreated datePublished" datetime="2020-02-21T18:54:25+08:00">2020-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Mybatis缓存</p>
<p>mybatis分为一级缓存和二级缓存，<strong>在默认的情况下，Mybatis只会开启一级缓存</strong></p>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><p>一级缓存是一次会话（SqlSession）的缓存，相当于本地缓存</p>
<p>对于同一个SqlSession对象，在参数和SQL完成一样的情况下，如果缓存没有过期，只执行一次SQL语句</p>
<p>一级缓存的生命周期:</p>
<ul>
<li><p>开启一个新的会话时会创建一个新的SqlSession对象，里面会存在一个新的Excutor对象，Excutor对象持有一个新的PerpetualCache对象，会话结束时，Excutor对象和PerpetualCache对象一起释放掉</p>
</li>
<li><p>SqlSession调用close方法后会清掉PerpetualCache，一级缓存就不可用了</p>
</li>
<li><p>调用clearCache，会清空PerpetualCache对象，但是可用</p>
</li>
<li><p>该SqlSession中执行insert，delete，update语句后会清除掉PerpetualCache中的数据</p>
</li>
</ul>
<p>完全相同的查询：</p>
<ul>
<li><p>传入的statementId（接口的形式就是方法名）</p>
</li>
<li><p>查询时的结果集中的结果范围</p>
</li>
<li><p>这次查询所产生的最终要传递给JDBC java.sql.Preparedstatement的Sql语句字符串（boundSql.getSql()没有参数）</p>
</li>
<li><p>传递给java.sql.Statement要设置的参数值</p>
</li>
</ul>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><p>Mybatis的二级缓存是全局缓存，他可以提高对数据库的查询效率，提高应用的性能</p>
<p>默认是不开启的，如果要开启，Mybatis要求返回的POJO是可序列化的，如果配置了二级缓存，就意味着：</p>
<ul>
<li>映射语句文件中的所有select语句将会被缓存。 </li>
<li>映射语句文件中的所欲insert、update和delete语句会刷新缓存。 </li>
<li>缓存会使用默认的Least Recently Used（LRU，最近最少使用的）算法来收回。 </li>
<li>根据时间表，比如No Flush Interval,（CNFI没有刷新间隔），缓存不会以任何时间顺序来刷新。 </li>
<li>缓存会存储列表集合或对象(无论查询方法返回什么)的1024个引用 </li>
<li>缓存会被视为是read/write(可读/可写)的缓存，意味着对象检索不是共享的，而且可以安全的被调用者修改，不干扰其他调用者或线程所做的潜在修改。 </li>
</ul>
<p>二级缓存开启的方式：</p>
<ol>
<li><p>在xml映射文件中声明</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启本mapper的namespace下的二级缓存--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        eviction:代表的是缓存回收策略，目前MyBatis提供以下策略。</span></span><br><span class="line"><span class="comment">        (1) LRU,最近最少使用的，一处最长时间不用的对象</span></span><br><span class="line"><span class="comment">        (2) FIFO,先进先出，按对象进入缓存的顺序来移除他们</span></span><br><span class="line"><span class="comment">        (3) SOFT,软引用，移除基于垃圾回收器状态和软引用规则的对象</span></span><br><span class="line"><span class="comment">        (4) WEAK,弱引用，更积极的移除基于垃圾收集器状态和弱引用规则的对象。这里采用的是LRU，</span></span><br><span class="line"><span class="comment">                移除最长时间不用的对形象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        flushInterval:刷新间隔时间，单位为毫秒，这里配置的是100秒刷新，如果你不配置它，那么当</span></span><br><span class="line"><span class="comment">        SQL被执行的时候才会去刷新缓存。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        size:引用数目，一个正整数，代表缓存最多可以存储多少个对象，不宜设置过大。设置过大会导致内存溢出。</span></span><br><span class="line"><span class="comment">        这里配置的是1024个对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        readOnly:只读，意味着缓存数据只能读取而不能修改，这样设置的好处是我们可以快速读取缓存，缺点是我们没有办法修改缓存，他的默认值是false，不允许我们修改</span></span><br><span class="line"><span class="comment">		type:指定自定义缓存的全限定名（需要实现Cache接口）</span></span><br><span class="line"><span class="comment">		blocking:若缓存中找不到对应的key，是否会一直blocking，直到有对应的数据进入缓存</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;LRU&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;100000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--可以通过设置useCache来规定这个sql是否开启缓存，ture是开启，false是关闭--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentMap&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        SELECT id, name, age FROM student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--刷新二级缓存</span></span><br><span class="line"><span class="comment">    &lt;select id=&quot;selectAllStudents&quot; resultMap=&quot;studentMap&quot; flushCache=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="comment">        SELECT id, name, age FROM student</span></span><br><span class="line"><span class="comment">    &lt;/select&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">在配置文件中开启</span><br><span class="line">   </span><br><span class="line">   ```xml</span><br><span class="line">   <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line">   <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">           <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--这个配置使全局的映射器(二级缓存)启用或禁用缓存--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">           .....</span><br><span class="line">       <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">       ....</span><br><span class="line">   <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> 当二级缓存开启后，同一个命名空间(namespace) 所有的操作语句，都影响着一个<strong>共同的 cache</strong>，也就是二级缓存被多个 SqlSession 共享，是一个<strong>全局的变量</strong>。当开启缓存后，数据的查询执行的流程就是 二级缓存 -&gt; 一级缓存 -&gt; 数据库。 </p>
</blockquote>
</li>
</ol>
<hr>
<p>参考：</p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/happyflyingpig/p/7739749.html">https://www.cnblogs.com/happyflyingpig/p/7739749.html</a> </p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_37139197/article/details/82908377">https://blog.csdn.net/weixin_37139197/article/details/82908377</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/cxuanBlog/p/11333021.html">https://www.cnblogs.com/cxuanBlog/p/11333021.html</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2020/01/15/redis%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%93%A8%E5%85%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/01/15/redis%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%93%A8%E5%85%B5/" class="post-title-link" itemprop="url">redis持久化和哨兵</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-15 09:05:38" itemprop="dateCreated datePublished" datetime="2020-01-15T09:05:38+08:00">2020-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><p>使用持久化能够保证数据不会程序退出等造成数据丢失的情况，重启时利用持久化文件就可以实现数据恢复。</p>
<p>redis支持两种持久化方式：</p>
<ul>
<li>RDB：RDB是把当前进程数据生成快照保存到硬盘的过程，可手动触发和自动触发</li>
<li>AOF（append only file）：以独立的日志方式记录每次写命令。重启时重新执行AOF文件中的命令以恢复数据</li>
</ul>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h4 id="手动触发"><a href="#手动触发" class="headerlink" title="手动触发"></a>手动触发</h4><ul>
<li>save命令</li>
<li>bgsave命令</li>
</ul>
<p>save命令会阻塞当前Redis服务器，直到RDB过程完成为止，对于内存比较大的实例会造成长时间的阻塞</p>
<p>bgsave命令是针对save命令做的优化，采用子线程去执行RDB操作，只会在fork操作创建子线程的阻塞，一般比较短，fork操作完成后会输出一段话：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Background saving <span class="literal">started</span></span><br></pre></td></tr></table></figure>

<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>开启AOF需要设置配置<code>appendonly</code>为yes</p>
<p>AOF工作流程分为几部：</p>
<p>命令写入-》AOF缓冲-》AOF文件</p>
<p>重启的时候会去加载目录下的AOF文件</p>
<h4 id="重写机制"><a href="#重写机制" class="headerlink" title="重写机制"></a>重写机制</h4><p>命令不断写入AOF会使文件越来越大，所以redis引入AOF重写机制压缩文件体积，<strong>AOF重写是把redis进程内的数据转化为写命令同步到新AOF文件的过程</strong></p>
<p>重写分为手动触发和自动触发：</p>
<ul>
<li><p>手动触发：调用<code>bgrewriteaof</code>命令</p>
</li>
<li><p>自动触发：根据<code>auto-aof-rewrite-min-size</code>和<code>auto-aof-rewrite-percentage</code>参数确定自动触发的时机</p>
<p>自动 触发 时机= aof_ current_ size&gt; auto- aof- rewrite- min- size&amp;&amp;（ aof_ current_ size- aof_ base_ size）/ aof_ base_ size&gt;= auto- aof- rewrite- percentage</p>
</li>
</ul>
<h3 id="路径和文件名称"><a href="#路径和文件名称" class="headerlink" title="路径和文件名称"></a>路径和文件名称</h3><p>RDB文件的生成路径通过配置文件中的<code>dir</code>字段设置，AOF也是如此</p>
<p>RDB文件的名称通过<code>dbfilename</code>配置</p>
<p>AOF文件的名称通过<code>appendfilename</code>配置</p>
<p>redis默认会对RDB文件进行压缩处理，默认开启，可以通过<code>rdbcopression</code>开启和关闭</p>
<h3 id="重启加载"><a href="#重启加载" class="headerlink" title="重启加载"></a>重启加载</h3><p><img src="/static/redis%E9%87%8D%E5%90%AF%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt=""></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="动态设置配置"><a href="#动态设置配置" class="headerlink" title="动态设置配置"></a>动态设置配置</h4><p>可在redis运行过程中通过</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config <span class="builtin-name">set</span> [参数名] [参数值]<span class="built_in"></span></span><br><span class="line"><span class="built_in">config </span><span class="builtin-name">get</span> [参数名]</span><br></pre></td></tr></table></figure>

<p>设置参数值，但是有效范围只在当次运行过程中，重启后失效</p>
<h4 id="磁盘满了的情况"><a href="#磁盘满了的情况" class="headerlink" title="磁盘满了的情况"></a>磁盘满了的情况</h4><p>可以通过config set dir [rdb的文件位置]，在运行时修改生成文件的位置，然后执行bgsave命令进行磁盘的切换</p>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><ul>
<li><p>RDB：</p>
<ul>
<li><p>优点：</p>
<p>RDB代表redis在某个时间点的快照，适用于备份，全量复制</p>
<p>redis加载RDB文件的速度远远快于AOF的方式</p>
</li>
<li><p>缺点：</p>
<p>RDB方式没办法做到实时持久化，因为RDB操作执行成本比较高</p>
<p><strong>RDB文件在redis版本更迭中有多个格式的RDB文件，存在老版本Redis无法兼容新版RDB格式的问题</strong></p>
</li>
</ul>
</li>
<li><p>AOF：</p>
</li>
</ul>
<h2 id="哨兵"><a href="#哨兵" class="headerlink" title="哨兵"></a>哨兵</h2><p>哨兵是为了解决redis主从复制过程中，主节点因为故障不能够提供服务，自动的将从节点升为主节点，并通知应用方更新主节点的解决架构</p>
<hr>
<h2 id="关于redis的一些问题"><a href="#关于redis的一些问题" class="headerlink" title="关于redis的一些问题"></a>关于redis的一些问题</h2><p> <a target="_blank" rel="noopener" href="https://juejin.im/post/5db66ed9e51d452a2f15d833">https://juejin.im/post/5db66ed9e51d452a2f15d833</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2019/09/12/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2019/09/12/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url"> 使用docker搭建redis集群		</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-12 12:08:05" itemprop="dateCreated datePublished" datetime="2019-09-12T12:08:05+08:00">2019-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lianggp/p/8136222.html">docker redis4.0 集群（cluster）搭建</a></p>
<h2 id="创建redis容器"><a href="#创建redis容器" class="headerlink" title="创建redis容器"></a>创建redis容器</h2><h3 id="1-创建配置文件"><a href="#1-创建配置文件" class="headerlink" title="1.创建配置文件"></a>1.创建配置文件</h3><p>要搭建集群的文件夹下创建redis-cluster.tmpl，内容为以下内容，根据需要更改我这里文件在<code>/root/redis-cluster</code>(后面会用到这个路径)下</p>
<pre><code>port $&#123;PORT&#125;
protected-mode no
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 39.10X.XX.XX //自己服务器IP
cluster-announce-port $&#123;PORT&#125;
cluster-announce-bus-port 1$&#123;PORT&#125;
appendonly yes</code></pre><p>如果需要密码则加上配置</p>
<pre><code>masterauth 123456
requirepass 123456</code></pre><p>注：5.x以下版本不支持在创建集群的时候指定密码，所以要先创建好集群之后，再设置密码，5.x+版本支持在创建集群的时候指定参数<code>-a</code>来指定创建集群时候密码</p>
<h3 id="2-docker创建集群的网络"><a href="#2-docker创建集群的网络" class="headerlink" title="2.docker创建集群的网络"></a>2.docker创建集群的网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create redis-net</span><br></pre></td></tr></table></figure>


<h3 id="3-生成配置信息"><a href="#3-生成配置信息" class="headerlink" title="3.生成配置信息"></a>3.生成配置信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `seq 7000 7005`; <span class="keyword">do</span> \</span><br><span class="line">  mkdir -p ./<span class="variable">$&#123;port&#125;</span>/conf \</span><br><span class="line">  &amp;&amp; PORT=<span class="variable">$&#123;port&#125;</span> envsubst &lt; ./redis-cluster.tmpl &gt; ./<span class="variable">$&#123;port&#125;</span>/conf/redis.conf \</span><br><span class="line">  &amp;&amp; mkdir -p ./<span class="variable">$&#123;port&#125;</span>/data; \</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<p>执行之后会在当前目录下生成 7000-7005的文件夹，对应不同的端口，里面包含conf和data文件夹</p>
<h3 id="4-创建redis容器"><a href="#4-创建redis容器" class="headerlink" title="4.创建redis容器"></a>4.创建redis容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `seq 7000 7005`; <span class="keyword">do</span> \</span><br><span class="line">  docker run -d -ti -p <span class="variable">$&#123;port&#125;</span>:<span class="variable">$&#123;port&#125;</span> -p 1<span class="variable">$&#123;port&#125;</span>:1<span class="variable">$&#123;port&#125;</span> \</span><br><span class="line">  -v /root/redis-cluster/<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/usr/<span class="built_in">local</span>/etc/redis/redis.conf \</span><br><span class="line">  -v /root/redis-cluster/<span class="variable">$&#123;port&#125;</span>/data:/data \</span><br><span class="line">  --restart always --name redis-<span class="variable">$&#123;port&#125;</span> --net redis-net \</span><br><span class="line">  redis:4.0 redis-server /usr/<span class="built_in">local</span>/etc/redis/redis.conf; \</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<p>这里会启动6个redis 打开端口7000-7005,17000-17005并映射到了主机，将端口文件夹中的配置文件挂载到容器中，端口文件夹中的data文件夹挂载到容器中的/data下并自动重启 注：这里使用的是redis的4.0版本</p>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><h3 id="3-x版本"><a href="#3-x版本" class="headerlink" title="3.x版本"></a>3.x版本</h3><p>redis在4.x+版本提供了对docker的友好支持，如果需要redis能够使用外网访问，最好使用redis4.x+版本。3.x版本使用docker的默认网络配置只能够创建内网能够访问的docker redis集群，如果需要外网能够访问可能要更改redis-net的网络模式为host，并使用<code>redis-trib.rb</code>来创建集群，这里没有做尝试。</p>
<h3 id="4-x版本"><a href="#4-x版本" class="headerlink" title="4.x版本"></a>4.x版本</h3><p>使用ruby来指定redis的<code>redis-trib.rb</code>来创建集群 注：5.0的redis版本似乎不支持使用这种方式（5.0使用redis-cli来创建集群，使用5.0的话不需要使用ruby，用其中一个redis实例来执行redis-cli创建集群的命令即可），所以这里的<code>redis-trib.rb</code>文件需要使用5.0以下的版本，参考文章中的获取的<code>redis-trib.rb</code>是属于stable版本的，最新stable版本的似乎已经是5.0的了，所以这里需要去到redis5.0版本以下的源码中去获取该文件。</p>
<h4 id="1-下载redis-trib-rb"><a href="#1-下载redis-trib-rb" class="headerlink" title="1.下载redis-trib.rb"></a>1.下载<code>redis-trib.rb</code></h4><p>下载redis4.x的源码文件（自行下载，这里不赘述），解压，我这里解压到<code>/root/redis-4.0.12</code>这个文件夹下的</p>
<h4 id="2-使用ruby-redis-trib-rb-创建集群"><a href="#2-使用ruby-redis-trib-rb-创建集群" class="headerlink" title="2.使用ruby + redis-trib.rb 创建集群"></a>2.使用ruby + redis-trib.rb 创建集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> yes | docker run -i --rm -v /root/redis-4.0.12/src/redis-trib.rb:/redis-trib.rb --net redis-net ruby sh -c <span class="string">&#x27;\</span></span><br><span class="line"><span class="string">  gem install redis -v 4.0 \</span></span><br><span class="line"><span class="string">  &amp;&amp; ruby redis-trib.rb create --replicas 1 \</span></span><br><span class="line"><span class="string">  &#x27;</span><span class="string">&quot;<span class="subst">$(for port in `seq 7000 7005`; do \</span></span></span><br><span class="line"><span class="subst"><span class="string">    echo -n <span class="string">&quot;<span class="subst">$(docker inspect --format &#x27;&#123; &#123; (index .NetworkSettings.Networks <span class="string">&quot;redis-net&quot;</span>)</span>.IPAddress &#125;&#125;&#x27; &quot;</span>redis-$&#123;port&#125;<span class="string">&quot;)&quot;</span>:$&#123;port&#125; &#x27; &#x27; ; \</span></span></span><br><span class="line"><span class="subst"><span class="string">  done)</span>&quot;</span></span><br></pre></td></tr></table></figure>


<p>这里就是将<code>/root/redis-4.0.12/src/redis-trib.rb</code>该文件挂载到容器的<code>/redis-trib.rb</code>这个目录下，然后使用ruby来执行该文件创建集群</p>
<h3 id="5-x版本"><a href="#5-x版本" class="headerlink" title="5.x版本"></a>5.x版本</h3><p>5.x使用redis-cli来创建集群，所以这里不需要去挂载<code>redis-trib.rb</code>,单独启动一个5.x的redis实例，指定redis-cli创建集群的命令就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> yes | docker run -i --rm -p 6379 --net redis-net redis:5.0 \</span><br><span class="line">   redis-cli --cluster create \</span><br><span class="line">   $(<span class="keyword">for</span> port <span class="keyword">in</span> `seq 7000 7005`; <span class="keyword">do</span> \</span><br><span class="line">     <span class="built_in">echo</span> -n <span class="string">&quot;<span class="subst">$(docker inspect --format &#x27;&#123; &#123; (index .NetworkSettings.Networks <span class="string">&quot;redis-net&quot;</span>)</span>.IPAddress &#125;&#125;&#x27; &quot;</span>redis-<span class="variable">$&#123;port&#125;</span><span class="string">&quot;)&quot;</span>:<span class="variable">$&#123;port&#125;</span> <span class="string">&#x27; &#x27;</span> ; \</span><br><span class="line">     <span class="keyword">done</span>) $(<span class="built_in">echo</span> <span class="string">&quot;--cluster-replicas 1&quot;</span>)</span><br></pre></td></tr></table></figure>


<p>如果使用了密码加上配置（5.x+版本支持，在配置文件中加<code>masterauth</code> <code>requirepass</code>属性）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a 123456</span><br></pre></td></tr></table></figure>


<p>即</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> yes | docker run -i --rm -p 6379 --net redis-net redis:5.0 \</span><br><span class="line">   redis-cli --cluster create \</span><br><span class="line">   $(<span class="keyword">for</span> port <span class="keyword">in</span> `seq 7000 7005`; <span class="keyword">do</span> \</span><br><span class="line">     <span class="built_in">echo</span> -n <span class="string">&quot;<span class="subst">$(docker inspect --format &#x27;&#123; &#123; (index .NetworkSettings.Networks <span class="string">&quot;redis-net&quot;</span>)</span>.IPAddress &#125;&#125;&#x27; &quot;</span>redis-<span class="variable">$&#123;port&#125;</span><span class="string">&quot;)&quot;</span>:<span class="variable">$&#123;port&#125;</span> <span class="string">&#x27; &#x27;</span> ; \</span><br><span class="line">     <span class="keyword">done</span>) $(<span class="built_in">echo</span> <span class="string">&quot;--cluster-replicas 1 -a 123456&quot;</span>)</span><br></pre></td></tr></table></figure>


<p>注：</p>
<ol>
<li><p>操作环境为cento7</p>
</li>
<li><p>注意各种路径</p>
</li>
<li><p>执行之前要保证之前填的自己的IP的服务器的端口7000-7005,17000-17005端口是打开的，云服务器端口也要打开（如果需要外网连接的话），要不有可能一直卡在</p>
<pre><code>Waiting for the cluster to join...</code></pre></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2019/08/23/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2019/08/23/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url"> mysql存储过程		</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-23 15:09:15" itemprop="dateCreated datePublished" datetime="2019-08-23T15:09:15+08:00">2019-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/l5580/p/5993238.html">Mysql存储过程</a> <a target="_blank" rel="noopener" href="http://imysql.com/mysql-refman/5.7/sql-syntax.html#declare-handler">DECLARE … HANDLER</a></p>
<h2 id="存储过程的创建"><a href="#存储过程的创建" class="headerlink" title="存储过程的创建"></a>存储过程的创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名()</span><br></pre></td></tr></table></figure>


<h2 id="存储过程的删除"><a href="#存储过程的删除" class="headerlink" title="存储过程的删除"></a>存储过程的删除</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除存储过程后面不需要跟(),只给出存储过程名</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> productpricing;     </span><br></pre></td></tr></table></figure>


<h3 id="删除时先判断是否存在"><a href="#删除时先判断是否存在" class="headerlink" title="删除时先判断是否存在"></a>删除时先判断是否存在</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> productpricing</span><br></pre></td></tr></table></figure>


<h2 id="Mysql命令行客户机的分隔符"><a href="#Mysql命令行客户机的分隔符" class="headerlink" title="Mysql命令行客户机的分隔符"></a>Mysql命令行客户机的分隔符</h2><p>默认的MySQL语句分隔符为分号;作为语句分隔符。如果命令行实用程序要解释存储过程自身的 ; 字符，则他们最终不会成为存储过程的成分，这会使存储过程中的SQL出现句法错误，解决方法是临时更改命令实用程序的语句分隔符，使用DELIMITER</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 定义新的语句分隔符为//</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line"><span class="comment">-- 表示开始存储过程</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> products;</span><br><span class="line"><span class="comment">-- 表示存储过程结束</span></span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="comment">-- 改回原来的语句分隔符为;</span></span><br><span class="line">DELIMITER ;    </span><br><span class="line"><span class="comment">-- 除\符号外，任何字符都可以作为语句分隔符</span></span><br></pre></td></tr></table></figure>


<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="入参"><a href="#入参" class="headerlink" title="入参"></a>入参</h3><p>创建存储过程时指定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 每个参数都要指定类型</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing(</span><br><span class="line">    <span class="keyword">IN</span> param1 <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> param2 <span class="type">Integer</span>(<span class="number">11</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h3 id="出参（返回值）"><a href="#出参（返回值）" class="headerlink" title="出参（返回值）"></a>出参（返回值）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 每个参数都要指定类型 DEFAULT用于指定默认值</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing(</span><br><span class="line">    <span class="keyword">IN</span> param1 <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> &quot;&quot;,</span><br><span class="line">    <span class="keyword">IN</span> param2 <span class="type">INT</span>(<span class="number">11</span>),</span><br><span class="line">    <span class="keyword">OUT</span> param3 <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">OUT</span> param4 <span class="type">TIMESTAMP</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 这里调用时指定了出参的变量，前面要加@</span></span><br><span class="line"><span class="keyword">CALL</span> productpricing(&quot;调用入参&quot;,<span class="number">11</span>,<span class="variable">@outParam1</span>,<span class="variable">@outParam2</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@outParam1</span>,<span class="variable">@outParam2</span></span><br></pre></td></tr></table></figure>


<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 定义局部变量，局部变量声明要放在存储过程开始的地方</span></span><br><span class="line"><span class="keyword">DECLARE</span> x <span class="type">VARCHAR</span>(<span class="number">11</span>);</span><br></pre></td></tr></table></figure>


<h3 id="查询赋值"><a href="#查询赋值" class="headerlink" title="查询赋值"></a>查询赋值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> _roleId <span class="type">INT</span>(<span class="number">11</span>);</span><br><span class="line"><span class="keyword">DECLARE</span> _roleName <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br><span class="line"><span class="comment">-- 可以使用INTO将查询语句中的列结果赋值给变量</span></span><br><span class="line"><span class="keyword">SELECT</span> role_id,role_name</span><br><span class="line"><span class="keyword">INTO</span> _roleId,_roleName</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">sys_role</span><br></pre></td></tr></table></figure>


<h3 id="设置变量的值"><a href="#设置变量的值" class="headerlink" title="设置变量的值"></a>设置变量的值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> x <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>


<h2 id="流程控制语句"><a href="#流程控制语句" class="headerlink" title="流程控制语句"></a>流程控制语句</h2><h3 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IF</span></span><br><span class="line">IF x <span class="operator">=</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys_role;</span><br><span class="line"><span class="comment">-- ELSEIF</span></span><br><span class="line">ELSEIF x <span class="operator">=</span> <span class="number">6</span> <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> sys_role;</span><br><span class="line"><span class="comment">-- ELSE 这里不用写THEN</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line"><span class="keyword">SELECT</span> role_name <span class="keyword">FROM</span> sys_role;</span><br><span class="line"><span class="comment">-- IF执行之后一定要END IF，这里有;</span></span><br><span class="line"><span class="keyword">END</span> IF;</span><br></pre></td></tr></table></figure>


<h3 id="Case语句"><a href="#Case语句" class="headerlink" title="Case语句"></a>Case语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> [<span class="keyword">case</span>值]</span><br><span class="line"><span class="keyword">WHEN</span> [条件] <span class="keyword">THEN</span> [执行的内容]</span><br><span class="line"><span class="keyword">WHEN</span> [条件] <span class="keyword">THEN</span> [执行的内容] </span><br><span class="line"><span class="keyword">ELSE</span> [执行的内容]</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">CASE</span></span><br></pre></td></tr></table></figure>


<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>游标（cursor）是一个存储在MYSQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。 <strong>使用游标</strong> 使用游标涉及几个明确的步骤：</p>
<ol>
<li><p>在能够使用游标前，必须声明（定义）它，这个过程实际上没有检索数据，它只是定义要使用的SELECT语句</p>
</li>
<li><p>一旦声明后，必须打开游标以供使用。这个过程用钱吗定义的SELECT语句吧数据实际检索出来</p>
</li>
<li><p>对于填有数据的游标，根据需要取出（检索）的各行</p>
</li>
<li><p>在接受游标使用时，必须关闭它 <strong>如果不明确关闭游标，MySQL将会在到达END语句时自动关闭它</strong></p>
</li>
</ol>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><p>游标可用DECLARE 语句创建。 DECLARE命名游标，并定义相应的SELECT语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> [游标名称] <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> [查询语句];</span><br><span class="line"><span class="comment">-- 例子</span></span><br><span class="line"><span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> role_id <span class="keyword">FROM</span> sys_role;</span><br></pre></td></tr></table></figure>


<h3 id="打开和关闭游标"><a href="#打开和关闭游标" class="headerlink" title="打开和关闭游标"></a>打开和关闭游标</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> [游标名称];</span><br><span class="line"><span class="comment">-- CLOSE释放游标使用的所有内部内存和资源，因此，每个游标不需要时都应该关闭</span></span><br><span class="line"><span class="keyword">CLOSE</span> [游标名称];</span><br></pre></td></tr></table></figure>


<h3 id="使用游标数据"><a href="#使用游标数据" class="headerlink" title="使用游标数据"></a>使用游标数据</h3><p>在一个游标被打开后，可以使用FETCH语句分别访问它的每一行。FETCH指定检索什么数据（所需的要列），检索出来的数据存储在什么地方。它还向前移动游标中的内部行指针，使下一条FETCH语句检索下一行从第一行到最后一行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 每次FETCH取的是一行的数据</span></span><br><span class="line"><span class="keyword">FETCH</span> cura <span class="keyword">INTO</span> userId,roleId,roleName;</span><br></pre></td></tr></table></figure>


<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><p>有几种循环游标的方式</p>
<ul>
<li>WHILE [循环条件] DO [循环体] END WHILE</li>
<li>REPEAT [循环体] UNTIL [结束标志] END REPEAT;</li>
<li>loop名称:LOOP …… END LOOP; 使用 LEAVE [loop名称] 可以 离开LOOP循环</li>
</ul>
<p>定义循环结束的标志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;02000&#x27;</span> <span class="keyword">SET</span> [变量]<span class="operator">=</span><span class="literal">TRUE</span>;</span><br><span class="line"><span class="comment">-- 或者下面的也可以</span></span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> [变量] <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br></pre></td></tr></table></figure>


<p>关于MYSQL的DECLARE…HANDLER用法可以参考 <a target="_blank" rel="noopener" href="http://imysql.com/mysql-refman/5.7/sql-syntax.html#declare-handler">DECLARE … HANDLER</a></p>
<h2 id="比较完整的例子"><a href="#比较完整的例子" class="headerlink" title="比较完整的例子"></a>比较完整的例子</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 如果存在就删除</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> testPro;</span><br><span class="line"><span class="comment">-- 定义分隔符</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="comment">-- 创建存储过程</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> testPro(</span><br><span class="line">    <span class="keyword">IN</span> inParam <span class="type">Int</span>(<span class="number">11</span>),</span><br><span class="line">    <span class="keyword">OUT</span> outParam <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 定义局部变量</span></span><br><span class="line">    <span class="keyword">DECLARE</span> _roleName <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> done BIT <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> roleName <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> roleId <span class="type">INT</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> userId <span class="type">INT</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="comment">-- 定义一个游标</span></span><br><span class="line">    <span class="keyword">DECLARE</span> cura <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> id,role_id,role_name <span class="keyword">FROM</span> sys_user;</span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;02000&#x27;</span> <span class="keyword">SET</span> done<span class="operator">=</span><span class="literal">TRUE</span>;</span><br><span class="line">    <span class="comment">-- 也可以这样写DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;</span></span><br><span class="line">    <span class="comment">-- 查询表</span></span><br><span class="line">    <span class="keyword">SELECT</span> role_name</span><br><span class="line">    <span class="comment">-- 将查询的结果赋值给_roleName</span></span><br><span class="line">    <span class="keyword">INTO</span> _roleName</span><br><span class="line">    <span class="keyword">FROM</span> sys_role <span class="keyword">WHERE</span> role_id <span class="operator">=</span> inParam;</span><br><span class="line">    <span class="comment">-- 设置outParam的值</span></span><br><span class="line">    IF _roleName <span class="operator">=</span> &quot;ADMIN&quot; <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> outParam <span class="operator">=</span> &quot;管理员&quot;;</span><br><span class="line">    ELSEIF _roleName <span class="operator">=</span> &quot;EMPLOYEE&quot; <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> outParam <span class="operator">=</span> &quot;员工&quot;;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">SET</span> outParam <span class="operator">=</span> &quot;未知&quot;;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="comment">-- 打开游标</span></span><br><span class="line">    <span class="keyword">OPEN</span> cura;</span><br><span class="line">        <span class="comment">-- 循环</span></span><br><span class="line">        REPEAT</span><br><span class="line">            <span class="keyword">FETCH</span> cura <span class="keyword">INTO</span> userId,roleId,roleName;</span><br><span class="line">            IF roleId <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span></span><br><span class="line">                UPDATE sys_user <span class="keyword">SET</span> role_name <span class="operator">=</span> (<span class="keyword">SELECT</span> role_name <span class="keyword">FROM</span> sys_role <span class="keyword">WHERE</span> role_id <span class="operator">=</span> roleId) <span class="keyword">WHERE</span> id <span class="operator">=</span> userId;</span><br><span class="line">            <span class="keyword">END</span> IF;</span><br><span class="line">        UNTIL done <span class="keyword">END</span> REPEAT;</span><br><span class="line">    <span class="keyword">CLOSE</span> cura;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> testPro(<span class="number">2</span>,<span class="variable">@testOut</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@testOut</span>;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2019/04/09/lets-encrypt%E6%B3%9B%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2019/04/09/lets-encrypt%E6%B3%9B%E5%9F%9F%E5%90%8Dssl%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url"> Let's Encrypt泛域名SSL证书配置		</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-09 09:53:35" itemprop="dateCreated datePublished" datetime="2019-04-09T09:53:35+08:00">2019-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%9D%82/" itemprop="url" rel="index">
                    <span itemprop="name">杂</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.laozuo.org/11668.html">Let’s Encrypt泛域名SSL证书申请</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/esofar/p/9291685.html">快速签发 Let’s Encrypt 证书指南</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dbe180979e77">acme.sh 配合 letsencrypt 配置泛域名</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh">acme.sh的GitHub</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>必备软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y curl socat cron</span><br></pre></td></tr></table></figure>

<p>安装acme.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>

<p>整个安装过程进行了以下几步，了解一下即可：</p>
<ol>
<li>把 acme.sh 安装到当前用户的主目录<code>$HOME</code>下的<code>.acme.sh</code>文件夹中，即<code>~/.acme.sh/</code>，之后所有生成的证书也会放在这个目录下；</li>
<li>创建了一个指令别名<code>alias acme.sh=~/.acme.sh/acme.sh</code>，这样我们可以通过<code>acme.sh</code>命令方便快速地使用 acme.sh 脚本；</li>
<li>自动创建<code>cronjob</code>定时任务, 每天 0:00 点自动检测所有的证书，如果快过期了，则会自动更新证书。</li>
</ol>
<p>安装命令执行完毕后，执行<code>acme.sh --version</code>确认是否能正常使用<code>acme.sh</code>命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.acme.sh/</span><br><span class="line">./acme.sh --version</span><br><span class="line">-------------------------------</span><br><span class="line">https://github.com/Neilpang/acme.sh</span><br><span class="line">v2.8.1</span><br></pre></td></tr></table></figure>

<p>更高级的安装选项请参考: <a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/wiki/How-to-install">https://github.com/Neilpang/acme.sh/wiki/How-to-install</a></p>
<h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><p><code>acme.sh</code> 支持直接使用主流 DNS 提供商的 API 接口来完成域名验证以及一些相关操作具体 <a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/tree/master/dnsapi">dnsapi 链接</a></p>
<p>以阿里云为例：</p>
<p>首先获取你的阿里云API Key: <a target="_blank" rel="noopener" href="https://ak-console.aliyun.com/#/accesskey">https://ak-console.aliyun.com/#/accesskey</a></p>
<p>注：如果使用阿里RAM访问权限控制，需要授权<code>管理HTTPDNS的权限</code> <code>管理云解析(DNS)的权限</code>这两个权限</p>
<p>编辑acme.sh，加入</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">Ali_Key</span>=<span class="string">&quot;自己的AccessKeyID&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">Ali_Secret</span>=<span class="string">&quot;自己的AccessKeySecret&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./acme.sh --issue -d 域名 -d *.域名 --dns dns_ali --<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p><code>--log</code>表示生成日志文件<code>acme.sh.log</code>，方便生成失败的时候查看原因</p>
<p>如果想自定义证书目录可以加上<code>-w</code>参数</p>
<h2 id="Nginx配置SSL"><a href="#Nginx配置SSL" class="headerlink" title="Nginx配置SSL"></a>Nginx配置SSL</h2><p>Nginx支持SSL要先安装ssl模块<code>--with-http_ssl_module</code></p>
<p>生成dhparam</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/<span class="built_in">local</span>/nginx/ssl</span><br><span class="line">sudo openssl dhparam -out /usr/<span class="built_in">local</span>/nginx/ssl/dhparam.pem 2048</span><br></pre></td></tr></table></figure>

<p>生成会生成一段时间</p>
<h3 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h3><p>生成的证书是放在<code>~/acme.sh/域名</code>下的，这是<code>acme</code>内部目录，不应该让nginx直接读取，所以使用<code>--installcert</code>命令将证书文件放到其他位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./acme.sh  --installcert -d 域名 \</span><br><span class="line">         --key-file /usr/<span class="built_in">local</span>/nginx/ssl/域名.key \</span><br><span class="line">         --fullchain-file /usr/<span class="built_in">local</span>/nginx/ssl/fullchain.cer \</span><br><span class="line">         --reloadcmd <span class="string">&quot;service nginx force-reload&quot;</span></span><br><span class="line">------------或者--------------</span><br><span class="line">./acme.sh --installcert -d 域名 -key-file /usr/<span class="built_in">local</span>/nginx/ssl/域名.key --fullchain-file /usr/<span class="built_in">local</span>/nginx/ssl/fullchain.cer --reloadcmd <span class="string">&quot;server nginx force-reload&quot;</span></span><br></pre></td></tr></table></figure>

<p>注：<code>--reloadcmd</code>可以不加，这个表示安装完成后执行的命令，但是最好是填上，基本每隔两个月就会执行一次，就需要重载或重启nginx证书才能及时的更新</p>
<h3 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h3><p>这里只展示了必要配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>      <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> 域名;</span><br><span class="line">    <span class="comment"># 访问80端口重定向到https端口</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  域名;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /usr/local/nginx/ssl/fullchain.cer;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /usr/local/nginx/ssl/域名.key;</span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /usr/local/nginx/ssl/dhparam.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ssl的详细设置可以查看<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html">Module ngx_http_ssl_module</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://casecy.github.io/blog/2019/04/08/wordpress-docker%E6%90%AD%E5%BB%BA-https%E5%8C%96%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="C.c">
      <meta itemprop="description" content="A Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Me">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2019/04/08/wordpress-docker%E6%90%AD%E5%BB%BA-https%E5%8C%96%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url"> wordpress docker搭建 https化记录		</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-08 09:38:52" itemprop="dateCreated datePublished" datetime="2019-04-08T09:38:52+08:00">2019-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 19:16:16" itemprop="dateModified" datetime="2021-07-06T19:16:16+08:00">2021-07-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/docker/%E6%9D%82/" itemprop="url" rel="index">
                    <span itemprop="name">杂</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wushangjue/p/7795969.html">Centos7.4下用Docker-Compose部署WordPress</a></p>
<h2 id="使用docker-compose创建wordpress"><a href="#使用docker-compose创建wordpress" class="headerlink" title="使用docker-compose创建wordpress"></a>使用docker-compose创建wordpress</h2><p>安装略过 编写docker-compose.yml文件 写入如下内容：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">db:</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">     <span class="attr">volumes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">db_data:/var/lib/mysql</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">     <span class="attr">environment:</span></span><br><span class="line">       <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&quot;your password&quot;</span></span><br><span class="line">       <span class="attr">MYSQL_DATABASE:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">MYSQL_USER:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">MYSQL_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">wordpress:</span></span><br><span class="line">     <span class="attr">depends_on:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">wordpress:latest</span></span><br><span class="line">     <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">wp_site:/var/www/html</span></span><br><span class="line">     <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;9000:80&quot;</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">     <span class="attr">environment:</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db:3306</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">wordpress</span></span><br><span class="line">       <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">wordpress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="attr">db_data:</span></span><br><span class="line">    <span class="attr">wp_site:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx-network</span></span><br></pre></td></tr></table></figure>


<p>docker创建一个网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create nginx-network</span><br></pre></td></tr></table></figure>


<p>然后使用docker-compose构建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>


<h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><p>按照上面的内容 wordpress可以通过端口9000访问，但是现在先不忙访问 在对应的域名服务商上配置好域名映射，使域名能够正确访问到服务器的80端口（Nginx） 配置好了之后修改Nginx配置，将请求代理到9000端口 注：这时候还没有配置https</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> ssl&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:9000</span> weight=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://ssl;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host $http_host;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-NginX-Proxy <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>重启nginx，就可以访问到网站了 https从现在开始配置 首先配置好wordpress，然后到wordpress中下载一个插件<strong>Really Simple SSL</strong> 这时候点击启用，会提示没有证书，下一步就是将https配置到Nginx上 这里略过 配置好了之后，通过https访问刚才的页面的时候，就会有启用https，点击启用，就可以使用https访问了</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="docker的一些命令"><a href="#docker的一些命令" class="headerlink" title="docker的一些命令"></a>docker的一些命令</h3><p>查看创建的数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>


<p>删除所有没有用到的数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>


<p>查看数据卷对应主机的位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect --format <span class="string">&#x27;&#123; &#123; .Mountpoint &#125;&#125;&#x27;</span> 数据卷名称</span><br></pre></td></tr></table></figure>


<p>停掉docker-compose，和up一样需要在docker-compose.yml目录执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-copose down</span><br></pre></td></tr></table></figure>


<p>列出现在的网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure>


<p>查看容器的日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs 容器id/名称</span><br></pre></td></tr></table></figure>


<h3 id="docker版本"><a href="#docker版本" class="headerlink" title="docker版本"></a>docker版本</h3><p>查看docker版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>


<p>本文使用的docker 版本为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Client:</span><br><span class="line"> Version:           18.09.3</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.8</span><br><span class="line"> Git commit:        774a1f4</span><br><span class="line"> Built:             Thu Feb 28 06:33:21 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.3</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.8</span><br><span class="line">  Git commit:       774a1f4</span><br><span class="line">  Built:            Thu Feb 28 06:02:24 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br></pre></td></tr></table></figure>


<h3 id="Nginx配置http端口跳转到https端口"><a href="#Nginx配置http端口跳转到https端口" class="headerlink" title="Nginx配置http端口跳转到https端口"></a>Nginx配置http端口跳转到https端口</h3><p>方式一</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>      <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> 域名;</span><br><span class="line">        <span class="attribute">rewrite</span> /(.*) https://$host/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>方式二 在方式一基础上将rewrite修改为</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">return</span>      <span class="number">301</span> https://$server_name$request_uri;</span><br></pre></td></tr></table></figure>


<p>还有些其他方式，自行百度</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/6/">6</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">C.c</p>
  <div class="site-description" itemprop="description">A Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CaseCy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CaseCy" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://liquidcat.cc/" title="Blog → https:&#x2F;&#x2F;liquidcat.cc" rel="noopener" target="_blank"><i class="fa fa-fw fa-gratipay"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/cononyc" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;cononyc" rel="noopener" target="_blank"><i class="fa fa-fw fa-user-circle"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备2021018575号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">C.c</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
